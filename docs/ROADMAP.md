# WhatsApp AI Qualy — Roadmap

> **Last Updated:** 2026-02-24 (Lowered AI QA Lab fixture minimum to 150 lines, kept Quick/Regression token budgets at 100k, hardened generator execution with retry diagnostics, added legacy DB constraint compatibility for run queue inserts, updated generator quality rules for random-sector/lead-qualification fixtures, raised scenario density with 3-6 turn bounds, added QA run credit-usage visibility, decoupled QA execution from tenant org/skills via synthetic KB-only responder flow, increased generator max output tokens to reduce JSON truncation failures, refined Judge pricing-groundedness rule to avoid false positives when KB has no numeric price, refined engagement-question rules to penalize only repetitive/context-breaking follow-ups, added per-run USD cost estimation from input/output token usage, added intake-fulfillment/handoff-readiness coverage metrics to QA execution/judging/detail UI, de-prioritized communication-preference as a mandatory intake field, tightened generator semantic-diversity/fallback-line validation, added auto-stabilization for low-diversity fixture outputs before final quality validation, added question-aware customer-turn adaptation so QA scenario turns follow the assistant’s prior clarification context, hardened QA turn coherence with urgency-aware intake semantics/service-catalog-aware customer adaptation/contradiction filtering/deeper turn distribution/citation-strict Judge evidence rules, added sector-agnostic semantic intake fulfillment + responder blocked-field re-ask guard + inferable-field Judge penalties, added Judge consistency guards (strict-score retry + citation-attribute mismatch filtering), fixed intake asked-coverage false negatives for natural question phrasing with asked/fulfilled contradiction normalization, enforced per-scenario Judge assessments with case-level fallback coverage plus run-detail visibility, stabilized Judge JSON reliability with dynamic output-token scaling + invalid-JSON recovery retry, capped QA preset scenario count to 15 for run stability, improved QA judge/responder quality with cold-resistant fail-to-warn calibration + citation-verified repetitive-question filtering + fallback-fixture artifact cleanup + explicit field-named clarification questions, tightened simulation realism with timeline-over-callback intake normalization, active-missing-field follow-up enforcement, truncated numbered-list response sanitization, fixed QA run launch FIFO misfires by executing the newly created run ID directly after enqueue instead of relying on batch-1 queue worker selection, excluded internal `AI QA LAB` org from system-admin picker/context and admin dashboard/list aggregates, hardened QA responder/judge sector-agnostic behavior with refusal-aware intake fulfillment, policy/procedure request-mode intake de-prioritization, category-based missing-field prompts, case-level judge missing-field consistency guards, per-scenario effective required-intake scoping for policy/procedure scenarios, plus type-like semantic field fulfillment, explicit general-info routing priority, exact-field judge summary/finding consistency normalization, scenario-assessment-aware run-result classification, broader sector-agnostic service-signal matching, actionable/non-pressuring generic-fallback normalization, enforced generator hot/warm/cold + resistant mix validation, strengthened urgency-value semantics to reduce re-ask loops, reinforced responder KB baseline + repeated-engagement suppression, added citation-level did-not-ask false-positive filtering, added low-information response penalties in scenario assessments, tightened generic continuation alignment in synthetic customer turns, suppressed engagement prompts after explicit stop-contact requests, extended per-scenario empty-intake scoping to general-information mode, filtered generic intake-missing Judge claims when case-level coverage already shows sufficient progress, added QA assistant-side answer-first/refusal-aware/non-qualification-intake-strip/no-progress-loop-break guards, introduced turn-level request-mode promotion from informational turns to qualification turns, tightened repetitive-findings to same-field repeat evidence, replaced website/phone redirect phrasing with chat-first next-step continuation, sanitized repeated fixture expansion suffix artifacts, enforced follow-up missing-field closure questions with refusal-safe retry behavior, strengthened direct-question answer-first guarantees with grounded pre-answer insertion, removed `Ek bilgi` filler style from low-information enrichment, added mini-summary + next-step closure phrasing for qualification turns, added explicit-evidence gating for closure summaries (no unverified “not aldım” claims), normalized snake_case intake labels to human-readable questions, standardized resistant pricing flow to one soft critical-field ask with no-pressure continuation, and fixed Usage credit undercount for high-volume orgs by paginating usage-debit ledger reads beyond the default 1000-row API cap, prioritized lead-intent request-mode routing over incidental policy-fact overlap, added customer-turn-first promotion from policy/general scenarios into qualification mode when intent becomes actionable, expanded external-contact redirect sanitization for phone/contact-details phrasing, cleared stale scenario issues whenever consistency checks explicitly mark those claims as cleared, tightened non-numeric-pricing judge normalization for false-positive “concrete pricing” penalties, upgraded generic-unknown responder fallback to grounded KB-detail continuation when available, made `Özel İstekler` style intake fields soft/optional by default, enabled dynamic minimum required-field sets for short (3-turn) lead-qualification scenarios, added scenario auto-stabilization when actionable lead-coverage ratio is below threshold, and strengthened QA response-language consistency with improved Turkish-ASCII detection + mixed-language snippet normalization.)  
> Mark items with `[x]` when completed.

---

## Phase 0: Project Setup ✅
- [x] Initialize project repository
- [x] Set up development environment
- [x] Choose and configure tech stack
- [x] Set up CI/CD pipeline (Vercel auto-deploys)
- [x] Configure database (Supabase client ready)
- [x] Set up environment variables
- [x] Codify agent workflow rules (always provide commit message)
- [x] Add subagent-driven-development skill for plan execution workflow
- [x] Use system fonts in app shell to avoid CI font-fetch issues
- [x] Self-host Plus Jakarta Sans from local project assets (`public/fonts/plus-jakarta-sans`) and remove runtime Google Fonts import

---

## Phase 1: Core Infrastructure ✅
- [x] **Multi-Tenant Foundation**
  - [x] Create organization model
  - [x] Implement `organization_id` isolation
  - [x] Set up RLS policies
- [x] **Auth & User Management**
  - [x] Supabase Auth integration
  - [x] User-organization relationship
  - [x] Role-based access (admin, member)
  - [x] Signout redirect now resolves `register` URL from runtime request origin instead of static app URL env fallback

---

## Phase 2: Messaging Channels
- [x] **WhatsApp (Meta Cloud API)**
  - [x] Choose provider (Meta Cloud API selected for MVP)
  - [x] Finalize MVP scope (OAuth channel setup, inbound text-only, reactive replies only)
  - [x] Write WhatsApp integration design document (`docs/plans/2026-02-08-whatsapp-meta-cloud-mvp-design.md`)
  - [x] Webhook endpoint for incoming messages
  - [x] Outgoing message API
  - [x] OAuth connect flow (`/api/channels/meta/start` + `/api/channels/meta/callback`)
  - [x] One-click connect from channel card (no intermediate "continue with Meta" modal)
  - [x] OAuth error/status redirects return to current channels route using signed/safe `returnTo` path
  - [x] OAuth connect now opens in a dedicated popup window and pushes success/error status back to the main Channels page
  - [x] OAuth host resolution hardened for Netlify custom-domain deployments (configured app URL + forwarded host fallback)
  - [x] Popup return flow now preserves `meta_oauth_error` for direct diagnosis on Channels URL
  - [x] WhatsApp OAuth candidate discovery falls back from `/me/whatsapp_business_accounts` to business-edge lookup (`/me/businesses` + owned/client WABA edges)
  - [x] WhatsApp OAuth now requests only WhatsApp scopes (`whatsapp_business_management`, `whatsapp_business_messaging`) to avoid `Invalid Scopes: business_management` failures on newer Meta apps
  - [x] WhatsApp OAuth candidate selection no longer requires WABA `name`; connect flow now succeeds when Graph returns `id + phone_numbers` without `name`
  - [x] WhatsApp OAuth candidate hydration now fetches `/{waba_id}/phone_numbers` when nested `phone_numbers` is missing from WABA list responses
  - [x] Channels page now shows OAuth popup result feedback (`success` / failure reason) instead of silently returning with no visible status
  - [x] Meta OAuth authorize URL now enforces permission re-consent (`auth_type=rerequest`) and Graph errors include endpoint path in server logs for faster permission debugging
  - [x] WhatsApp OAuth supports env toggle `META_WHATSAPP_INCLUDE_BUSINESS_MANAGEMENT=1` to include `business_management` when required by `/me/businesses` fallback on certain Meta app setups
  - [x] WhatsApp fallback no longer forces `/me/businesses` on `Missing Permission` unless `META_WHATSAPP_INCLUDE_BUSINESS_MANAGEMENT=1`, so unsupported `business_management` apps fail on the real direct endpoint instead of looping into invalid-scope recovery
  - [x] WhatsApp callback now attempts `debug_token`-based WABA discovery when direct `/me/whatsapp_business_accounts` request fails, so missing-permission direct-edge failures can still complete connect without forcing `business_management`
- [x] **Telegram (Sandbox)**
  - [x] Channel connect + webhook registration
  - [x] Incoming message webhook
  - [x] Outgoing message API
  - [x] Skill-match failures fail open to KB/fallback instead of dropping reply flow
- [x] **Instagram (Meta Messaging)**
  - [x] Channel connect via Meta OAuth + webhook verification
  - [x] Incoming message webhook
  - [x] Outgoing message API (reactive replies only)
  - [x] First bot reply starts only after inbound customer message
  - [x] One-click connect from channel card (no intermediate "continue with Meta" modal)
  - [x] OAuth popup flow mirrors WhatsApp and keeps main app context stable during Meta auth
  - [x] Channels card connect CTA is temporarily disabled and shown as `Çok Yakında` for non-connected orgs
- [x] **Facebook Messenger (Placeholder)**
  - [x] Added Channels settings card with `Çok Yakında` CTA (no backend integration in MVP)
  - [x] Placeholder card icon now uses `public/messenger.svg` and follows stacked row-card layout in Channels settings
- [x] **Shared Inbound AI Pipeline**
  - [x] Keep Telegram/WhatsApp/Instagram webhook routes separate
  - [x] Move inbound AI flow to shared pipeline function and reuse in WhatsApp + Instagram
- [x] **Message Handling Core**
  - [x] Store incoming messages
  - [x] Store outgoing messages
  - [x] Conversation threading

---

## Phase 3: Skill System ✅
- [x] **Skill CRUD**
  - [x] Create skill model
  - [x] Admin UI for skill management
  - [x] Enable/disable toggle
- [x] **Skill Matching Engine**
  - [x] Embedding generation for triggers
  - [x] Embedding generation now includes skill titles in addition to triggers
  - [x] Similarity search (top-5)
  - [x] LLM re-ranking
  - [x] Confidence threshold logic
- [x] **Skill Testing**
  - [x] Simulator is the canonical skill testing surface for MVP (no separate per-skill playground)

## Phase 3.5: Chat Simulator (Neutral Chatbot UI) ✅
- [x] **Chat Interface**
  - [x] Neutral chatbot UI (channel-agnostic bubbles, header, and input)
  - [x] Org-specific simulator URL
- [x] **Simulation Logic**
  - [x] Connect to Skill Matching Engine
  - [x] Simulate typing delay
  - [x] Debug mode for matching details
  - [x] **RAG Fallback:** Matches production logic (KB search if no skill found)
- [x] **Dynamic Controls**
  - [x] Sensitivity threshold slider
  - [x] Token usage breakdown (input/output) per message
  - [x] Conversation-level token usage totals
  - [x] Hide debug token breakdown (keep per-message + conversation totals)
- [x] **Fallback Guidance:** Offer topic suggestions from skills/KB when no match is found

## Phase 3.6: Refinements & Inbox ✅
- [x] **Inbox UI**
  - [x] Conversation list with lazy loading
  - [x] Message history view
  - [x] Delete conversation functionality
  - [x] Composer banner copy + centered layout
  - [x] Details avatar initials match conversation list
  - [x] Conversation avatars use shared initials/colors across list, chat, and details
  - [x] Lead snapshot grouped under Key Information with contact header restored
  - [x] Conversation details panel now shows cumulative AI credit usage (all AI operations) since conversation start
  - [x] Conversation AI credit totals are now persisted on the conversation record (trigger + backfill), and inbox details read the stored total without per-open recomputation
  - [x] Score reasoning UI uses locale-aware copy and labels
  - [x] Lead extraction paused notice + manual refresh in details panel
  - [x] Lead snapshot header shows AI extraction chip and status uses dot + text
  - [x] Platform row shows channel icon and channel cards use consistent icon sizing
  - [x] Platform icons in Channels cards + Inbox badges/details + Leads list now use shared public SVG assets (`/Telegram.svg`, `/whatsapp.svg`, `/instagram.svg`, `/messenger.svg`)
  - [x] Inbox list avatars include platform badges for quick channel recognition
  - [x] Inbox list platform badges enlarged with brand-colored icons
  - [x] Inbox list platform badges centered under avatars
  - [x] Inbox list platform badges adjusted for size and placement
  - [x] Inbox list platform badges lowered and icon size increased
  - [x] Inbox list platform badges lowered further with thinner borders
  - [x] Inbox list lead status shown as a right-aligned chip on the name row
  - [x] Inbox list time moved to a dedicated third row under message preview
  - [x] Inbox bot message bubbles now use a darker background with light text for better contrast
  - [x] Unread indicators in sidebar + conversation list
  - [x] Real-time updates (via polling/subscriptions)
  - [x] On-demand conversation summary (button + inline panel)
  - [x] Conversation summary minimum-message threshold updated to `3` customer messages (bot message optional)
  - [x] Closing and reopening summary panel now regenerates summary without requiring manual refresh
  - [x] WhatsApp conversations now show a far-right 24-hour reply-window indicator (`reply available / reply unavailable`) next to the summary control with tooltip reason when blocked
  - [x] Inbox composer now disables manual send for WhatsApp when the 24-hour free-form window is closed, shows a short lock overlay message, and keeps `active_agent` unchanged
  - [x] Mobile inbox app flow with list-to-conversation transition and back navigation
  - [x] Mobile chat header details toggle with compact contact/lead snapshot
  - [x] Mobile details payload now includes lead summary, service type, and collected required info
  - [x] Mobile operator takeover view shows a visible Leave Conversation action
  - [x] Mobile list/detail navigation uses slide transitions (forward/back)
  - [x] Mobile details panel now dims background with a dark overlay and closes on outside tap
  - [x] Mobile details panel open/close now uses smooth transition (fade + slight slide)
  - [x] Inbox list header no longer shows the dropdown chevron next to the title
  - [x] Inbox list header surface now matches the list column background for consistent sidebar visuals
  - [x] Chat view now shows an animated "scroll to latest" button only when not at bottom, positioned on the composer divider
  - [x] Reduced vertical gap between the "Konuşma Özeti" row and the assistant banner in composer area
  - [x] "Konuşma Özeti" action now uses a glowing gradient AI sparkles icon (filled style) plus an inline chevron toggle beside the label
  - [x] Shadow/Off bot modes now show compact inactive-state banner copy (single-line title + short body) in composer area
  - [x] Active bot assistant banner now follows the same spacing/typography layout as inactive banner (color palette unchanged)
  - [x] Conversation switch now shows loading skeletons until selected-thread messages load, preventing avatar-first stale content flashes
  - [x] Lead status chips now sync after manual lead refresh and realtime lead events, including `ignored` (`Yok sayıldı`) and `undetermined` (`Belirsiz`)
- [x] **Refactoring**
  - [x] Migrate to Lucide Icons
  - [x] Primitive component cleanup
  - [x] Skills and Knowledge Base primary CTA buttons now use `#242A40` accent styling
  - [x] Skills detail header delete/save actions now use standardized icon + label pattern (desktop/mobile compatible)
  - [x] Unsaved changes guard save callback now tracks pending-link transform dependency to avoid stale navigation targets
  - [x] Next.js locale interceptor moved from `src/middleware.ts` to `src/proxy.ts` (Next 16 convention)
- [x] **Navigation Shell**
  - [x] Crisp-inspired main sidebar with collapse toggle and persisted state
  - [x] Refined collapsed icon layout and toggle placement (Netlify-style)
  - [x] Centered collapsed logo alignment
  - [x] Sidebar header branding uses `logo-black.svg` when expanded and `icon-black.svg` when collapsed
  - [x] Browser tab branding now uses `Qualy` title metadata and `/icon-black.svg` favicon/icons
  - [x] Browser tab title is route-aware (`Page | Qualy`) and Inbox title uses a dot indicator `(●)` for unread instead of numeric count
  - [x] Collapsed sidebar brand icon scaled up to match active navigation item size
  - [x] Eyebrow section labels for grouped navigation
  - [x] Increased spacing between header and first sidebar section
  - [x] Sidebar nav icons use active/passive variants per item
  - [x] Yönetim/Admin menü ikonları `react-icons/hi2` (Heroicons v2) setiyle standardize edildi
  - [x] Sidebar accent and active-state color updated from blue to `#242A40`
  - [x] Mobile bottom navbar with 5 items (Inbox, Kişiler, Yetenekler, Bilgi Bankası, Diğer)
  - [x] Mobile “Diğer” quick menu with Simülatör, Ayarlar, and Signout
  - [x] Mobile “Diğer” menüden tekrar eden Faturalandırma/Kullanım kısa yolları kaldırıldı (Ayarlar içinden erişim tek kaynak)
  - [x] Mobile Skills page now uses app-style single-pane navigation (list page → detail page with back action)
  - [x] Mobile Skills detail header uses shorter labels (`Düzenle`, `Kaydet`) to reduce top-bar clutter
  - [x] Mobile Settings now uses app-style single-pane navigation (settings list page → detail page with back action)
  - [x] Mobile Settings detail pages now use animated back transition to the settings list (Inbox-style slide-out)
  - [x] Mobile Settings back action now performs client-side navigation (no full refresh feel on detail→list return)
  - [x] Mobile Settings detail geri akışında history döngüsü düzeltildi (`replace` tabanlı geri dönüş)
  - [x] Desktop Settings now keeps the inner settings sidebar persistent while only detail content switches/loading states
  - [x] Mobile Knowledge Base now uses a single-pane flow (sidebar hidden on mobile and files rendered as responsive cards)
  - [x] Mobile Knowledge edit header now uses compact labels (`Düzenle`, `Kaydet`) and icon-only back affordance
  - [x] Mobile bottom navbar now prefetches primary routes for faster tab transitions
  - [x] Desktop main sidebar and settings shell now prefetch settings routes to reduce transition latency
  - [x] Desktop main sidebar now prefetches core workspace/AI/admin routes for faster route transitions
  - [x] Main sidebar Settings entry routing optimized for lighter first-load behavior vs legacy `/settings/channels`
  - [x] Desktop main sidebar Settings entry now opens `/settings/ai`, while mobile quick action keeps `/settings` list-first flow
  - [x] Route prefetch warmups now run with a short delayed schedule (main sidebar, settings shell, mobile nav) to reduce active-interaction jank
  - [x] Manual navigation prefetch warmups now run in both development and production by default (with env opt-out) to reduce first-click route latency
  - [x] Billing-locked navigation now keeps desktop/mobile main menus and Settings inner menu structure visible; non-billing destinations render as locked/non-clickable while Settings stays accessible via Plans
  - [x] Billing-locked workspace sidebar now forces bot status indicator to `Kapalı/Off` (instead of `Dinleyici/Shadow`) so lock state is communicated clearly
  - [x] Settings > Usage credit ledger table now keeps fixed column layout when toggling `Daha fazla göster / Daha az göster`
  - [x] Anonymous `/` entry now short-circuits to `/login` using Supabase auth-cookie detection before resolving organization context, reducing landing→app redirect delay
  - [x] Dashboard route fetch paths now remove redundant page-level `auth.getUser()` checks in favor of shared organization-context resolution to reduce repeated server roundtrips
  - [x] Dashboard layout now reuses user identity fields from active-organization context (full name/email) and removes an extra per-navigation profile query
  - [x] Active organization context + billing snapshot reads now use request-level caching so nested layout/page checks avoid duplicate DB calls on the same navigation request
  - [x] Removed explicit `force-dynamic` from Skills/Knowledge dashboard pages and parallelized Knowledge page data loading for faster warm-route transitions
- [x] **Inbox Reliability**
  - [x] Atomic operator assignment on manual send
  - [x] Message refresh fallback for bot/contact updates
  - [x] Realtime auth handshake for subscriptions
  - [x] Fixed inbox credit-usage refresh hook dependency regression causing React `useEffect` dependency-size console error in dev hot-reload
  - [x] Realtime auth token sync now refreshes missing tokens and listens to auth state changes to prevent stale inbox streams
  - [x] Realtime lead status updates for inbox list indicators
  - [x] Conversation list loading now falls back to flat per-table reads when nested relational query fails, preventing false empty-state inbox views
  - [x] Conversation list lead payloads are normalized for one-to-one nested responses so lead chips remain visible after full page refresh (without opening each thread)
- [x] **Internationalization**
  - [x] Remove hardcoded UI strings
  - [x] Enforce EN/TR parity with automated checks

---

## Phase 4: Knowledge Base (RAG) ✅
- [x] **KB CRUD**
  - [x] Create KB entry model
  - [x] Category support
  - [x] Admin UI for KB management
  - [x] Knowledge base route loading skeletons for instant navigation
  - [x] New Content source menu keeps placeholder providers visible and marks PDF as `Coming Soon` for transparency
- [x] **KB Status UI**
  - [x] Show indexing status per entry (Ready / Processing / Error)
  - [x] **RAG Pipeline**
- [x] Document chunking
- [x] Embedding storage
- [x] Retrieval logic
- [x] Response generation from KB
- [x] KB profile/intake suggestion context now truncates oversized document content before LLM handoff
- [x] **Enterprise RAG Hardening:** Documents + chunks schema, token-budgeted context, and consistent fallback handling
- [x] **Legacy Cleanup:** Remove `knowledge_base` in favor of documents/chunks
- [x] **Contextual KB Routing:** LLM decides KB usage and rewrites follow-up queries
  - [x] Include last bot reply + last 5 user messages with timestamps
- [x] **KB Routing Heuristics:** Definition-style questions route to KB when routing is uncertain
- [x] **Chunk Overlap Alignment:** Overlap respects paragraph/sentence boundaries to avoid mid-sentence splits
- [x] **KB Sidebar Sync:** Ensure folder create/delete triggers sidebar refresh
- [x] **KB Sidebar Sync:** Refresh counts on content create/update/delete events
- [x] **KB Sidebar Navigation:** Clicking files in the sidebar opens the document detail view
- [x] **KB Sidebar Focus:** Highlight the active document in the sidebar and add spacing between sections
- [x] **KB Sidebar Realtime:** Refresh sidebar immediately on knowledge document/collection changes
- [x] **KB Async Processing:** Save/create/update return immediately; background processing updates status with polling
- [x] **KB Realtime Publication:** Enable knowledge tables in Supabase realtime for instant sidebar updates
- [x] **KB Realtime Deletes:** Enable replica identity full so delete events include org context
- [x] **Suggestions Realtime Publication:** Add offering profile suggestions to Supabase realtime publication
- [x] **KB Non-blocking UI:** Create/edit/delete return immediately while background jobs continue
- [x] **KB Sidebar Uncategorized:** Show uncategorized items (max 10) with expand and correct all-content counts
- [x] **KB Terminology:** Replace "collection" labels with "folder" in UI copy
- [x] **KB Keyword Fallback:** Use keyword search when embedding lookup fails or returns no matches
- [x] **KB Banner Styling:** Use an amber tone for pending AI suggestion banners

---

## Phase 5: AI Auto-Reply Engine ✅
- [x] **Reply Router**
  - [x] Skill → KB → Topic-guided fallback response
  - [x] Response formatting
  - [x] Error handling
  - [x] Router responses now enforce a max output token cap for predictable cost
  - [x] Fallback/RAG responses now enforce max output token caps for predictable cost
  - [x] Shared inbound webhook RAG generation path (`src/lib/channels/inbound-ai-pipeline.ts`) now sets explicit `max_tokens`
  - [x] Enforce MVP reply-language rule in RAG/fallback/simulator prompts: Turkish only for Turkish customer messages, otherwise English only
- [x] **Bot Mode (Org-Level)**
  - [x] Active / Shadow / Off (Simulator excluded)
  - [x] AI Settings selector + sidebar status indicator
  - [x] Turkish copy refinements (Dinleyici label + clearer descriptions)
  - [x] Active mode copy mentions background lead extraction
  - [x] Sidebar status dot uses green/amber/red for Active/Dinleyici/Kapalı
- [x] **AI Settings:** Always-on flexible mode with a single threshold and prompt field
- [x] **AI Settings Copy:** Localized TR labels and sensitivity helper text
- [x] **AI Settings:** Configurable bot name (org-level)
- [x] **Human Escalation**
  - [x] AI Settings section: two-step flow (automatic escalation + skill handover), hot lead score slider, action cards, and locale-aware handover message
  - [x] Skill-level `Requires Human Handover` toggle with read-only message preview
  - [x] Centralized escalation policy with precedence: skill override > hot lead score
  - [x] Locale-aware handover message repair so TR UI no longer displays EN default text
  - [x] `notify_only` hot-lead behavior now keeps AI replies active based on `active_agent` state (stale assignee no longer blocks bot replies)
  - [x] `notify_only` hot-lead behavior no longer sends customer-facing handover promise; handover message is only emitted when escalation switches to operator (or skill-triggered forced handover)
- [x] **Default System Guardrail Skills (MVP)**
  - [x] Human support request skill (`requires_human_handover=true`)
  - [x] Complaint / dissatisfaction skill (`requires_human_handover=true`)
  - [x] Urgent / critical request skill (`requires_human_handover=true`)
  - [x] Privacy / consent / deletion request skill (`requires_human_handover=true`)
  - [x] Dedicated localized bot messages (TR/EN) per guardrail skill
  - [x] Keep low-confidence/no-safe-answer automatic handover out of scope (KB/fallback continues)
- [x] **AI Settings Prompt:** Locale-aware prompt default repair so TR UI shows Turkish prompt instructions
- [x] **AI Settings Prompt:** Legacy EN default prompt variants also normalize to TR default in TR UI
- [x] **Inbox UI:** Show configured bot name in chat labels
- [x] **Usage & Billing:** Track monthly calendar-month + all-time AI credit usage using ledger debits (`organization_credit_ledger` / `usage_debit`)
- [x] **Usage & Billing:** Keep Usage and Plans credit consumption consistent by reading the same debit source
- [x] **Usage & Billing:** Include operation-level breakdown for router, RAG, fallback, summary, lead extraction, and lead reasoning
- [x] **Usage & Billing UI:** Show calendar month label (`Europe/Istanbul`) in the monthly card header
- [x] **Usage & Billing UI:** Show only credit values (`30,3 kredi`) in monthly/all-time cards
- [x] **Usage & Billing UI:** Restore `Kullanım detayını gör` modal for per-operation credit visibility
- [x] **Usage & Billing UI:** Replace technical operation names with user-friendly labels (`AI yanıtları`, `Konuşma özeti`, `Kişi çıkarımı`, `Doküman işleme`)
- [x] **Usage & Billing UI:** Split document-processing credits (`hizmet profili`, `gerekli bilgiler`) from lead-extraction totals using usage metadata source mapping
- [x] **Usage & Billing UI:** Show month period in usage-breakdown modal header as `Bu ay • <Ay YYYY>` (same pattern as summary card)
- [x] **Usage & Billing UI:** Style `Detayı gör` action as black underlined link to match `Kullanımı gör` visual pattern in Plans
- [x] **Usage & Billing UI:** Render usage details modal via full-page portal overlay and compact 3-column table (`İşlem / Bu ay / Toplam`) so labels do not repeat and credit values stay on one line
- [x] **Usage & Billing Reliability:** Fix premium-plan `organization_ai_usage` insert failures by casting debit-trigger `credit_pool` CASE branches to `billing_credit_pool_type` enum (prevents `42804` and restores conversation credit accumulation)
- [x] **Usage & Billing Reliability:** Prevent Usage totals undercount for high-volume orgs by paginating `organization_credit_ledger` usage-debit reads and batching `organization_ai_usage` metadata lookups (avoids Supabase default 1000-row truncation)
- [x] **Settings UX:** Save buttons show a transient success state and clear dirty-state across settings pages
- [x] **Settings UX:** Two-column sections, header save actions, dirty-state enablement, and unsaved-change confirmation
- [x] **Settings UX:** Remove redundant current-value summaries above inputs
- [x] **Settings UX:** Align settings column widths and remove duplicate field labels for cleaner alignment
- [x] **Settings UX:** Refresh settings sidebar icons with bubbles/circle-user icons
- [x] **Settings UX:** Settings page headers now match sidebar item labels (AI + Organization)
- [x] **Organization Settings UX:** Move language selector near the bottom (above data deletion) and switch locale buttons to content-hug sizing
- [x] **Settings IA:** Removed dedicated General settings entry; language selector moved under Organization settings and `/settings/general` now redirects to `/settings/organization`
- [x] **AI Settings UI:** Compact bot mode/escalation selection cards (smaller title, radio, and padding)
- [x] **AI Settings UI:** Downsize selection card title text to section-title scale and reduce description font one step
- [x] **AI Settings UI:** Align sensitivity slider with hot lead threshold styling (blue `>=` right-side highlight)
- [x] **AI Settings Copy:** Rename handover notice label from “Asistan Sözü” to “Bot mesajı” (TR/EN)
- [x] **AI Settings Matching:** Apply inclusive threshold semantics (`>=`) for Skill + KB similarity checks
- [x] **Unsaved Changes Modal:** Make secondary buttons hug content, save CTA single-line, and discard soft-danger
- [x] **Profile/Organization Settings:** Basic pages for user and org details
- [x] **Organization Settings:** Add self-service organization contact-data deletion flow (`Settings > Organization`) with password-confirmed modal and irreversible delete confirmation
- [x] **Auth UX Refresh**
  - [x] Sign In redesign (settings-aligned UI)
  - [x] Sign Up redesign (settings-aligned UI)
  - [x] Sign In/Sign Up primary CTA + auth switch links now use ink accent `#242A40` (blue removed)
  - [x] Auth shell now includes logo header, EN/TR language switcher, and desktop visual canvas panel
  - [x] Auth right panel now uses animated messenger preview (user + Qualy typed/deleted message loop)
  - [x] Auth messenger flow now simulates send lifecycle (type -> sent -> input reset -> Qualy reply)
  - [x] Auth composer now shows empty-field caret state after typed send and includes short sending delay animation before user bubble appears
  - [x] Auth sending state now keeps typed text visible until dispatch completes, then resets to placeholder-style empty input
  - [x] Auth composer reduced to compact single-line style with animated size transition, and right-panel chat block is vertically centered
  - [x] Auth canvas now runs 3 distinct conversation scenarios (2 turns each) and keeps 4 bubbles visible before switching scenario
  - [x] Auth canvas now includes dynamic lead scoring block near canvas header text, updated after each message (2 hot scenarios, 1 cold scenario)
  - [x] Auth composer stays single-line while disabled and briefly expands during sending state (`Gönderiliyor...`)
  - [x] Lead scoring pre-message state now shows a waiting placeholder (no pre-message prediction shown)
  - [x] Lead scoring UI moved to compact internal-analysis chip under top-left canvas text with animated 0-100 progress bar and stronger hot-state emphasis
  - [x] Removed duplicate lead scoring panel under the composer (single scoring surface kept in top-left analysis chip)
  - [x] Support-only scenario closes with concise handoff copy (“Talebin destek ekibine iletildi.”)
  - [x] Auth bubbles now explicitly label customer messages as `Müşteri` for role clarity in the preview
  - [x] Auth preview chat thread now uses max-height + internal scroll with hidden scrollbar and top gradient fade so long simulated conversations do not expand auth page height
  - [x] Auth preview message bubbles are anchored at the bottom so chat stays immediately above the composer/input area
  - [x] Auth preview thread now uses fixed/clamped viewport height with top fade clipping so the 4th bubble no longer pushes layout on shorter desktop heights
  - [x] Auth preview incoming bot bubbles now use smooth enter animation + typing-height reservation to remove perceived jitter during agent typing
  - [x] Auth preview thread/composer spacing increased so multi-line bot bubbles no longer touch the input/composer area
  - [x] Auth preview thread/composer spacing and bubble gap density tightened to reduce excessive vertical whitespace
  - [x] Sign Up consent sentence now stays single-line on desktop and wraps only on smaller screens
  - [x] Removed in-form Sign In/Sign Up segmented switcher (route-level pages + footer link navigation only)
  - [x] Reduced auth header logo size for a lighter top bar visual balance
  - [x] Sign Up form simplified to Full Name + Email + Password + inline legal consent notice (no required checkbox)
  - [x] Sign Up consent copy now links `Hizmet Koşulları` and `Gizlilik Politikası` to `https://askqualy.com/terms` and `https://askqualy.com/privacy` in a new tab
  - [x] Sign Up consent notice now renders as plain inline text (no bordered/boxed wrapper)
  - [x] Sign In and Sign Up forms now support password show/hide toggle
  - [x] Mobile Sign In/Sign Up inputs now use iOS-safe sizing (`text-base` on small screens) to prevent keyboard-triggered auto zoom
  - [x] Auth shell now uses dynamic viewport height (`dvh`) with stable light background defaults to avoid top/bottom black bars on mobile
  - [x] Password Recovery flow (forgot + reset)
  - [x] Forgot/Reset password forms now use the same auth visual language as Sign In/Sign Up (no nested card wrapper, ink-accent focus/CTA/link styles)
  - [x] Profile security: password reset CTA + email immutable note
- [x] **Human Takeover**
  - [x] Detect business reply (or Inbox claim)
  - [x] Pause bot automatically (Active Agent State)
  - [x] "Resume Bot" via "Leave Conversation"

---

## Phase 6: Lead Extraction & Qualification
- [x] **Lead Model**
  - [x] Create lead schema
  - [x] Link to conversations
- [x] **Offering Profile (Catalog Optional)**
  - [x] Generate profile summary from Skills/KB
  - [x] Admin review + edit flow
  - [x] Manual profile + AI suggestions toggle (append-only)
  - [x] AI suggestions review tabs (pending/approved/rejected) with accept/reject actions
  - [x] Approved-only AI suggestions used in lead extraction
  - [x] Locale-aware AI suggestions + localized timestamps
  - [x] Pending suggestion indicators in settings (sidebar + section)
  - [x] AI Suggestions accordion header keeps a visible pending indicator even when collapsed
  - [x] AI Suggestions accordion header removes redundant right-side pending count chip
  - [x] AI suggestions panel toggles with manual generate when empty
  - [x] Main sidebar settings indicator reflects pending AI suggestions
  - [x] AI suggestions default enabled while respecting opt-out (no generation when off)
  - [x] Suggestion generation follows active UI locale (single-language)
  - [x] AI suggestion status can be toggled between approved/rejected
  - [x] Turkish UI terminology uses "Kişi" instead of "Lead"
  - [x] Suggestion tabs can be viewed even when empty
  - [x] Pending indicators refresh after review actions
  - [x] Hybrid AI suggestions (intro + up to 5 bullets) with update proposals for conflicting content
  - [x] Suggestion generation uses manual summary plus approved/rejected history for context
  - [x] Knowledge Base banner surfaces pending AI suggestions with quick link to Organization settings
  - [x] Knowledge Base “Review/İncele” link deep-links to Organization settings and auto-expands the AI Suggestions accordion
  - [x] Organization settings now expose separate AI toggles for Offering Profile and Required Fields
  - [x] Offering Profile AI disabled mode shows only manual textarea
  - [x] Offering Profile AI enabled mode shows AI suggestions workflow
  - [x] AI Suggestions accordion shows pending indicators both on the header and inside the accordion tabs/content
  - [x] Required Fields has its own AI suggestions toggle and remains a dedicated section
  - [x] Skill/KB updates auto-generate Required Fields AI chips and dedupe against existing manual/AI fields
  - [x] KB/fallback replies include a smart required-fields follow-up question (Telegram + Simulator) when key intake details are missing (skill replies stay unchanged) and use the last 3 assistant replies to avoid repeated greetings
  - [x] Telegram + Simulator final KB/RAG/fallback replies now use recent multi-turn history and known lead snapshot facts for smoother continuity (less repeated greetings and repeated question loops)
  - [x] Approved suggestions tab supports a persistent custom profile-note textarea (editable/removable, not converted into suggestion cards)
- [x] AI suggestions enforce 3-5 bullet hybrid format with retry on sparse output
- [x] AI suggestions archive (archived tab with archive action; regenerate when no pending)
  - [x] Knowledge Base banner copy updated to “Hizmet profili önerileri hazır” and spaced from header
- [x] **Service Catalog (Hybrid)**
  - [x] Auto-propose services from Skills/KB
  - [x] Direct auto-add workflow (no manual approve/reject queue)
  - [x] Organization Settings Service List section (manual chips + AI toggle + AI-tag badges)
  - [x] Turkish UI terminology update: `Servis listesi` -> `Hizmet listesi`
  - [x] AI service-candidate extraction now parses Skill/Knowledge content for multiple service names (not title-only)
- [x] **Non-Business Classification**
  - [x] Detect personal/non-business chats
  - [x] Skip lead extraction and scoring when flagged
- [x] **AI Extraction**
  - [x] Async extraction on each new customer message
  - [x] Extract: service, date, location, budget
  - [x] Intent analysis
  - [x] Risk signal detection
- [x] **Extraction Reliability**
  - [x] Parse fenced or noisy JSON outputs safely
  - [x] Required Fields parser now accepts fenced/noisy JSON responses from AI
  - [x] Enforce JSON response mode (`response_format: json_object`) for extraction/follow-up/offering-profile structured outputs
  - [x] Extraction and lead-reasoning/summary helpers now enforce max output token caps
  - [x] Label customer vs assistant messages and respect customer negations
  - [x] Use last 5 customer messages and LLM-provided score/status
  - [x] Add role-labeled recent-turn context (`customer`/`owner`/`assistant`) so short customer confirmations can resolve the referenced field reliably
  - [x] Ensure latest message is included even with async writes
  - [x] Enforce locale-aware output language (TR/EN) for lead summary and extracted detail fields
  - [x] Include manual profile note with approved AI suggestions in extraction context
  - [x] Preserve previously extracted lead details when later turns omit fields (merge-on-update instead of destructive overwrite)
  - [x] `service_type` is intentionally not carry-forward merged; when current extraction has no service clue, service stays empty (`null`)
  - [x] Keep lead summary aligned to the current extraction window (avoid stale summary carry-over when omitted)
  - [x] Reject `service_type` inference on greeting-only/no-service-clue customer messages (prevents profile-only service hallucination)
  - [x] Accept `service_type` when customer wording matches profile service signals even if inferred service text is in another language (prevents false `Unknown` on bilingual extraction output)
  - [x] Canonicalize accepted `service_type` to approved catalog service name when alias-language matches exist (keeps extraction output consistent with org catalog/UI language)
  - [x] Extract and persist `services[]` (one or more) and keep `service_type` as primary canonical service for backward compatibility
  - [x] Force greeting-only conversations to `undetermined` even when model emits `non_business=true` (keeps `ignored` scoped to true non-business threads)
  - [x] Resolve extraction language with precedence: explicit preferred locale, then organization locale, then message-language heuristics
- [x] **Lead Scoring**
  - [x] Implement 0-10 scoring algorithm
  - [x] Auto-generate AI summary
  - [x] Keyword-based intent fallback + score reasoning modal
- [x] **Lead Status**
  - [x] Hot / Warm / Cold classification
  - [x] Undetermined classification for insufficient-information turns (e.g., greeting-only/unclear short messages)
  - [x] Ignored status constrained to non-business conversations
  - [x] Status update triggers
- [x] **Inbox Lead Details**
  - [x] Read-only lead snapshot in conversation details
  - [x] Lead header shows "Updating" indicator during extraction
  - [x] Keep "Updated" timestamp visible while updating
  - [x] Show collected "Required Fields" values in lead details using Organization > Required Fields definitions
  - [x] Present collected required fields in an "Important info" card section with plain label-value rows inside
  - [x] Required-info resolver supports manual override precedence for future lead-edit workflows
  - [ ] Manual overwrite UI for "Important info" values in Inbox (per field edit + save source tracking)
- [x] **Lead List UX**
  - [x] Mobile leads list now uses compact card rows with reduced spacing while preserving the existing desktop table layout
  - [x] Desktop leads table keeps status chips on a single line and truncates long contact names to a single line
  - [x] Required-intake values shown in Inbox "Important info" are now rendered consistently in Leads table/mobile rows via shared resolver logic
  - [x] Leads service column/cards now render AI-extracted `services[]` values from `extracted_fields.services` (fallback to `service_type` for legacy rows)
- [x] **Operator Takeover Control**
  - [x] Toggle to keep lead extraction running during operator takeover (AI Settings)

---

## Phase 7: Admin Panel
- [x] **Dashboard**
  - [x] Overview stats
  - [x] Recent leads
- [ ] **Lead List**
  - [x] Filterable/sortable table
  - [x] Score, summary, status display
  - [ ] "Open in WhatsApp" button
- [x] **Skills Management**
  - [x] CRUD UI
  - [x] Search positioned above the unified skills list with always-visible add CTA
  - [x] Removed Core/Custom tab split; skills are managed in one list
  - [x] Skills empty-state icon now matches the sidebar Skills icon
  - [x] Backfill missing skill embeddings automatically when seeded skills exist without vectors
  - [x] Simulator-first testing accepted for MVP (no additional per-skill playground)
- [x] **Knowledge Base UI**
  - [x] CRUD with categories
  - [x] Rich text editor
- [x] **Channels**
  - [x] Telegram connection status + debug
  - [x] WhatsApp connection status + debug

---

## Phase 8: Platform Admin Features
- [x] System admin dashboard + organizations/users/leads lists
- [x] Organization switcher
  - [x] Searchable org switcher in main sidebar (system admin)
  - [x] Compact current-org summary in sidebar with explicit `Select/Change` action (always-open list removed)
  - [x] Modal-based organization picker with search, active marker, and reset action
  - [x] Persist active organization context via server-side cookie
  - [x] Apply switched org context across Inbox/Leads/Skills/Knowledge/Simulator/Settings
  - [x] Apply switched org context in platform-admin lead monitoring (`/admin` recent leads + `/admin/leads` list)
  - [x] Default home landing now routes system admins without explicit organization selection to `/admin` (not `/inbox`)
  - [x] Fallback to membership-linked org list when full system-admin organization query is unavailable
  - [x] Resolve system-admin active org in slim mode during navigation (avoid full org-list query on every route)
  - [x] Lazy-load full system-admin organization options only when org-picker modal opens
  - [x] Enforce read-only impersonation mode across tenant modules
  - [x] Show clear "viewing as organization" state and reset action
- [x] Admin route loading UX
  - [x] Admin organizations/users/detail routes now show explicit loading skeletons
  - [x] Loading UI now uses subtle animated `icon-black.svg` branding
- [ ] Cross-org debugging tools
  - [x] Admin-only org details page (`/admin/organizations/[id]`)
  - [x] Read org-level snapshots: usage, token usage, skills, knowledge stats (read-only table)
  - [x] Include profile-level details via user details view (multi-profile-ready membership listing)
  - [ ] Audit trail for admin-driven plan/quota updates
  - [x] Manual billing actions (system-admin): extend trial, adjust credits, assign/cancel premium with required reason
- [ ] Usage analytics per org
  - [x] Admin organization table columns: total usage, total token usage, total skill count, knowledge base count
  - [x] Admin organization table now shows current paid subscription fee with original billing currency (`TRY`/`USD`)
  - [x] Admin dashboard plan metrics now shows `Toplam Aylık Ödeme / Total Monthly Payment` (monthly plan + monthly extra-credit payment)
  - [x] Add premium/trial status visibility and plan cycle/status visibility (integrated with membership + credit snapshot read model)
  - [x] Add search + pagination for admin organization and user lists
  - [x] Compute admin dashboard stat cards via DB-side aggregate RPC (avoid full org summary scan on dashboard load)
  - [x] Clarify admin dashboard metrics: rename `Toplam Kullanım` card to `Toplam Mesaj` and show platform-wide credit usage when system admin has no explicit organization selection
  - [x] Add admin dashboard monthly plan metrics block (monthly plan payment amount/count, monthly top-up payment amount, monthly top-up credits purchased/used) and remove redundant overview/read-only/active-org summary cards
  - [x] Add admin dashboard period selector (`Tüm Zamanlar` + month) for message/token/used-credit cards
  - [x] Align admin used-credit totals with `organization_ai_usage`-based credit cost aggregation to fix dashboard vs organization-detail mismatches
  - [x] Move organization list search/pagination to DB-level count + range queries (no in-memory full-list slicing)
  - [x] Batch organization metric aggregation to avoid per-organization N+1 read fan-out
  - [x] Load organization detail profile layer with targeted org/member/profile queries (no full-table scans)
  - [x] Avoid heavy org-summary aggregation when building admin user lists (use lightweight organization lookup only)
  - [x] Load admin user detail via targeted profile + memberships + related-org snapshots (no full user/org scan)
- [x] Billing/Quota Visibility (Admin)
  - [x] Show premium/trial periods with membership/lock reason + credit used/remaining visibility (read-only)
  - [x] Show token/message usage values (read-only)
  - [x] Enable system-admin billing edit controls with required reason capture

---

## Phase 8.5: Monetization & Subscription (Pre-Pilot)
- [ ] **Pricing Strategy**
  - [x] Define plan tiers, quotas, and overage policy
  - [x] Confirm launch pricing posture: low-entry starter around ~USD 10 equivalent (TRY-localized) to reduce first-purchase friction
  - [x] Lock billing order: recurring monthly premium package first, then optional credit top-up overflow
  - [x] Lock top-up eligibility: disabled during trial; enabled for any active premium organization (package exhaustion not required)
  - [x] Lock package credit policy: monthly package credits do not roll over to the next billing cycle
  - [x] Define monthly premium package defaults (`X TL` price, `Y` included credits) and admin change boundaries
  - [x] Publish pricing/credit guide with token-based COGS, trial credit option analysis (`100/120/200/250/1000`), and recommended baseline (`docs/plans/2026-02-16-pricing-credit-strategy-guide.md`)
  - [x] Define Lovable-like `upgrade-first` reference model in pricing guide (plan-tier ladder + non-stacking mid-cycle upgrade behavior + premium burst top-up packs)
  - [x] Add customer-facing conversation-equivalent ranges and package-level cost/profit tables to pricing guide
  - [x] Set Turkish market baseline price points and localized USD prices (admin-configurable TRY/USD per plan and top-up)
  - [ ] Define annual discount policy
  - [ ] Finalize feature gating by plan (channels, AI limits, seats)
- [ ] **Plan Purchase (Online Payment)**
  - [ ] Select payment provider + integration model (TR compliance and invoice requirements; recurring subscriptions required)
  - [ ] Implement recurring monthly premium checkout flow
  - [ ] Implement top-up checkout flow (available for active premium subscriptions)
  - [ ] Implement payment webhook sync + failed-payment handling
- [ ] **Membership States (Trial / Premium)**
  - [x] Define state model (`trial_active`, `trial_exhausted`, `premium_active`, `past_due`, `canceled`, `admin_locked`)
  - [x] Enforce entitlements in tenant runtime and admin read models
  - [x] Surface membership state in settings and platform admin pages
- [ ] **Trial Policy Finalization**
  - [x] Decide trial model: trial-only launch (no freemium plan in pre-pilot)
  - [x] Define trial end behavior and lock rule: system locks token-consuming features when either time or credit cap is reached first
  - [x] Define trial limits and precedence (`14 days`, `200.0 credits`, precedence: whichever is reached first)
  - [ ] Finalize upgrade prompts for in-product conversion
  - [ ] Add grace/extension policy for manual sales-assisted overrides (if needed)
- [ ] **Paywall Implementation (Execution)**
  - [x] Add billing schema (`organization_billing_accounts`, `organization_credit_ledger`, `credit_purchase_orders`, `platform_billing_settings`) with RLS and entitlement SQL helpers
  - [x] Enforce paywall gates in inbound AI pipeline + dashboard token-consuming actions
  - [x] Split tenant settings IA into `/settings/plans` (subscription/top-up management entry) and `/settings/billing` (usage + receipts details)
  - [x] Refine IA split to remove duplicate plan controls from `/settings/billing` and keep `/settings/billing` focused on read-only account snapshot + ledger/usage analytics
  - [x] Add admin trial-default controls (new organizations only) and admin premium-package controls (`X TL`, `Y` credits)
  - [x] Add admin credit visibility (used/remaining/lock reason) on organization/user detail surfaces
  - [x] Add admin per-organization manual overrides: trial extension, top-up/trial/package credit increment-decrement, premium activation/deactivation, and membership/lock override
  - [x] Add admin per-organization billing action history visibility (audit rows with actor + reason)
  - [x] Add tenant billing paywall UI foundations (membership/lock banners, trial/package/top-up balances, credit usage history)
  - [x] Simplify tenant billing UX copy/labels (Plans + Billing) and remove non-essential Billing sub-analytics to keep decision-first flow
  - [x] Add lightweight usage visibility entry points in desktop sidebar and mobile More menu (trial + package progress and quick links to Plans action surface)
  - [x] Refine desktop sidebar + mobile More usage card copy to decision-first state matrix (trial credits until trial end, then package credits + top-up breakdown with actionable lock/upgrade hints)
  - [x] Standardize Turkish billing terminology to use `ücretsiz deneme` instead of `trial` in user-facing copy
  - [x] Refresh sidebar/mobile billing snapshot on checkout query updates so premium activation is reflected without manual page reload
  - [x] Standardize user-facing top-up terminology to `ek kredi / extra credits`
  - [x] Make sidebar usage card compact: default view shows remaining credits + decreasing progress bar, with chevron-expand breakdown (package vs extra credits)
  - [x] Gate system-admin tenant sidebar sections behind explicit organization selection (no selection shows only Admin navigation)
  - [x] Move platform billing default controls from `/admin` dashboard to dedicated `/admin/billing` page
  - [x] Expand platform billing defaults for multi-currency pricing catalog (Starter/Growth/Scale + top-up 250/500/1000 in TRY/USD) and seed final baseline values via migration `00061_multicurrency_pricing_catalog.sql`
  - [x] Update Scale package baseline from `999 TRY` to `949 TRY` to keep plan ending consistency
  - [x] Overhaul `/settings/plans` with package ladder + top-up ladder, organization billing-region-based currency display (TR=TRY, non-TR=USD), and safe monthly conversation-range marketing copy
  - [x] Replace manual billing-region selection in `/settings/organization` with automatic signup-time billing-region persistence on organization (`organizations.billing_region`) and use that persisted value as `/settings/plans` currency source (`TR` => `TRY`, non-TR => `USD`)
  - [x] Standardize Turkish package display names to `Temel / Gelişmiş / Profesyonel` across tenant plans and admin billing dictionaries
  - [x] Standardize `/admin` tables as full-width with horizontal overflow support
  - [x] Fix admin empty-state rendering on server routes by avoiding non-serializable icon component props across server-client boundaries
  - [x] Add mock checkout simulation (subscription + top-up success/failure states) to validate flow before real provider integration
  - [x] Add tenant self-serve subscription renewal controls in `/settings/plans` (turn auto-renew off/on with period-end effect) backed by migration `00062_mock_subscription_renewal_controls.sql`
  - [x] Align package-change UX with common SaaS behavior: upgrades stay immediate, downgrades are scheduled to next cycle with effective-date messaging, and tier cards hide direct downgrade CTA (`00063_mock_checkout_schedule_downgrades.sql`)
  - [x] Move premium subscription controls to modal-first UX: `Planı yönet / Manage plan` modal for tier changes + separate cancellation confirmation modal
  - [x] Improve top-up modal option-row readability: larger right-column price text and vertical centering
  - [x] Enforce billing hard-lock workspace mode: when entitlement is locked, tenant access is restricted to `/settings/plans` and `/settings/billing` only; inbox read/send access is blocked
  - [x] Backfill existing non-system-admin organizations into trial mode baseline for rollout (`00058` migration)
  - [x] Publish iyzico production-integration execution plan (`docs/plans/2026-02-17-iyzico-billing-integration-implementation-plan.md`)
  - [ ] Add recurring premium checkout + top-up checkout + payment webhook sync + idempotent credit grants
- [ ] **Trial Abuse Prevention**
  - [ ] Enforce one-trial-per-business policy keyed by `whatsapp_business_account_id` + normalized phone + company identity signals
  - [ ] Add risk controls for disposable email domains, VOIP-heavy signup numbers, and repeated device/IP fingerprints
  - [ ] Add signup velocity limits + cooldown windows for repeated failed/abusive trial attempts
  - [ ] Define suspicious-signup review flow (auto-restrict to sandbox/no-live-reply until manually cleared)
  - [ ] Add admin-side trial-abuse audit log for unblock/override actions

---

## Phase 8.6: Public Legal Center
- [x] Add markdown legal source folder (`legal/*.md`) with required version metadata (`id`, `version`, `last_updated`, `document_title`)
- [x] Add legal routing and rendering for `/legal`, `/terms`, `/privacy` on landing app
- [x] Add build-time legal manifest generation (`scripts/generate-legal-assets.mjs` -> `public/legal_versions.json`)
- [x] Wire footer legal navigation to legal center, privacy, and terms routes
- [x] Add Netlify SPA redirect fallback (`public/_redirects`) so direct legal route visits resolve to `index.html`
- [x] Simplify footer information architecture by removing Resources/Company columns and keeping Product + Legal columns
- [x] Route Product footer links to homepage sections with smooth auto-scroll (`features`, `pricing`, `how-it-works`)
- [x] Repoint Product scoring item to testimonials section and update label copy to testimonials (`#testimonials`)
- [x] Publish Facebook/Meta data-deletion instructions guide for landing implementation (`docs/FACEBOOK_DATA_DELETION_INSTRUCTIONS_GUIDE.md`)

---

## Phase 9: Testing & QA
- [x] Address strict TypeScript build errors (router history typing + indexed access guards)
- [x] Stabilize test + lint + build quality gates after troubleshooting sweep
- [x] Remove `no-explicit-any` debt in critical modules (AI, Inbox, Knowledge Base, Leads, Channels, shared types)
- [x] Document executable Phase 9 closure plan (`docs/plans/2026-02-10-phase-9-testing-qa-implementation-plan.md`)
- [x] Add non-photography Knowledge Base extraction QA fixture for dental-clinic domain validation (`docs/kb-fixtures/2026-02-dis-klinigi-kb-cikartim-test-fixture.md`)
- [x] Publish manual simulator-only AI QA Lab design for LLM-generated, multi-turn closed-loop evaluation (`docs/plans/2026-02-19-ai-qa-lab-llm-closed-loop-design.md`)
- [x] Implement admin `AI QA Lab` manual run queue + immutable run snapshot persistence (`qa_runs` migration, `Settings > QA Lab` page, server actions)
- [x] Implement runtime executor lifecycle (`queued -> running -> completed/failed`) with immutable artifact/report writes
- [x] Implement two-model QA flow (`Generator` + `Judge`) with QA-local responder execution (synthetic KB + fallback, no tenant skill/org dependency)
- [x] Implement run preset configuration surface (`Quick`, `Regression`) with hard token budgets (`100k`, `100k`) in run snapshots
- [x] Implement runtime budget-stop behavior (`BUDGET_STOPPED`) during scenario execution
- [x] Expose AI QA Lab in Admin navigation for system-admin workflow (`/admin/qa-lab`)
- [x] Exclude internal `AI QA LAB` organization from system-admin organization picker / active-context fallback so admin panel tenant selection stays clean
- [x] Exclude internal `AI QA LAB` organization from admin dashboard platform totals and admin organization read-model lists (`organizations`, `skills`, `knowledge docs`, `messages/tokens/credits` cards)
- [x] Standardize Admin AI QA Lab headers with consistent `Back/Geri` breadcrumb behavior
- [x] Move QA run launch to queue-first async flow with automatic background worker execution (no manual worker button in UI) to reduce timeout risk and keep trigger UX simple
- [x] Fix QA run launch FIFO misfire: UI now executes the newly created run ID directly after enqueue, preventing older queued runs from being picked first on `batch=1`
- [x] Harden QA responder/judge sector-agnostic consistency: refusal replies no longer count as fulfilled fields, policy/procedure intents de-prioritize intake forcing, missing-field prompts use category-based wording, and judge missing-field claims are filtered against case-level intake coverage
- [x] Add per-scenario effective required-intake scoping in QA execution/coverage so policy-procedure scenarios can opt out of global lead-qualification required fields
- [x] Improve QA sector-agnostic semantic/type-field handling and judge exact-field consistency: infer type-like fields from natural entity cues (`kedim`, `...yım`, `my X`), prioritize explicit general-info intent over generic service-word routing, and normalize/drop judge field-name mismatches against case-level intake coverage
- [x] Tighten QA sector-agnostic semantic fallback and judge scenario consistency: broad semantic fallback now applies only to generic fields (not timeline/business-size/etc.), intake categories recognize `timing` / `business size`, re-ask findings prefer judge-declared target field category, and cold+resistant+general-info fails are softened to `warn` when handoff readiness is already `pass`
- [x] Align QA run-result and responder fidelity with scenario reality: run result now treats scenario `warn/fail` assessments as `pass_with_findings` even when finding list is empty, service-detail detection recognizes broader sector-agnostic project/service wording, judge missing-field claim filters recognize `did not ask` style phrasing, and generic “no clear detail” fallbacks are rewritten to actionable but non-pressuring next steps
- [x] Tighten QA run realism for cross-sector simulation quality: enforce generator scenario-mix coverage (`hot/warm/cold` + at least one `resistant`), require urgency collection via value-level semantics (not keyword-only mention), strengthen responder KB baseline context with critical policy/service anchors, and suppress consecutive repeated engagement-question patterns
- [x] Add Judge output normalization into a pipeline improvement action set section on QA run details
- [x] Extend generator flow to produce sequential QA assets (`KB fixture -> derived setup -> scenario mix`) with hot/warm/cold + info-sharing variants for realistic lead-quality coverage
- [x] Expand QA run details to show full artifact chain (`KB fixture lines`, `ground truth references`, `derived setup`, `conversations`, `findings`) for manual QA review
- [x] Align AI QA Lab list/detail headers and layout with admin full-width page standard (`PageHeader` + left breadcrumb + full-width content)
- [x] Keep KB artifact UI compact with preview-first card and full-text modal viewer (no long inline KB block)
- [x] Add run-level sequential pipeline self-check block (`pass/warn/fail`) to validate KB -> setup -> scenario -> execution -> judge order
- [x] Harden QA generator execution with retry attempts and persisted attempt-level diagnostics on failure (`error.details.stage=generator`)
- [x] Lower QA fixture minimum-line requirement from `200` to `150` for run presets and DB validation
- [x] Refine Judge pricing-groundedness rule: if KB has no numeric pricing, no penalty for withholding exact price; penalize only fabricated pricing claims
- [x] Refine QA engagement-question policy: allow contextual single follow-up, penalize only repetitive/menu-like consecutive prompts
- [x] Add per-run USD cost estimation (`gpt-4o-mini` input/cache/output rates) to QA run report/list/detail surfaces
- [x] Add intake-fulfillment coverage analysis (required field asked/fulfilled/missing) and handoff-readiness signals to QA report, judge payload, pipeline checks, and run detail UI
- [x] Remove communication-preference from mandatory QA intake expectation (replace with better coordination signals) and penalize only repetitive asks
- [x] Tighten QA generator quality gate for semantic fixture diversity and excessive fallback-line artifacts
- [x] Add generator fixture auto-stabilization pass to repair low-diversity outputs before final quality gate failure
- [x] Adapt simulated customer turns to previous assistant clarifications (answer-or-boundary behavior) so execution transcripts remain context-coherent
- [x] Make simulated customer adaptation sector-aware via generated service catalog (remove education-specific fallback replies in non-education sectors)
- [x] Add history-aware contradiction filter for synthetic customer budget statements (avoid cross-turn budget drift when not explicitly re-asked)
- [x] Normalize urgency-like required fields (`Acil Durum` etc.) to actionable urgency intake and extend coverage matching with natural urgency language
- [x] Enforce deeper scenario-turn distribution in Quick/Regression generation (meaningful share of scenarios reach 4+ turns within 3-6 bounds)
- [x] Tighten Judge evidence discipline: each finding must include scenario/turn citation formatting before high-confidence reporting
- [x] Add sector-agnostic semantic intake fulfillment inference and responder blocked-field re-ask guard (fulfilled/deferred), and update Judge to penalize re-asking inferable provided fields
- [x] Add Judge consistency guards: retry suspiciously low judge scores with strict 0-100 scale and drop findings whose cited scenario attributes contradict finding text
- [x] Fix intake asked-coverage false negatives for natural question phrasing (e.g., "öğrenebilir miyim") and normalize asked/fulfilled contradictions (`asked=0` with high fulfillment)
- [x] Enforce per-scenario Judge assessments (answer quality, logic, groundedness) with fallback completion for omitted cases and expose results in run detail UI
- [x] Stabilize Judge JSON reliability via dynamic output-token scaling by scenario count + invalid-JSON recovery retry; cap QA preset scenario count to `15`
- [x] Reduce Judge false positives and improve QA realism: drop citation-backed `did not ask` mismatches when assistant already asked the field/category, penalize low-information assistant replies at scenario level, tighten synthetic customer continuation alignment to previous assistant prompts, and suppress engagement questions after explicit stop-contact requests
- [x] Finalize QA-Lab intake scoping consistency: general-information scenarios now use empty required-intake scope like policy/procedure scenarios, and Judge generic missing-intake findings/issues are dropped when case-level intake coverage already indicates sufficient progression
- [x] Harden QA assistant realism: enforce answer-first ordering on direct questions, strip intake pressure in general-information/policy modes and refusal turns, and trigger soft no-progress next-step responses after two consecutive non-progress qualification turns
- [x] Apply run-driven QA stabilization patchset: promote request mode to qualification when customer intent becomes actionable mid-scenario, require same-field repeat evidence for repetitive-question findings, keep QA responses chat-first (no website/phone redirect loops), and sanitize duplicated fixture expansion suffixes
- [x] Harden sector-agnostic QA mode-routing and consistency cleanup: prioritize lead intent over incidental policy-fact overlap (unless explicit policy cues exist), force customer-turn-first policy/general -> qualification promotion for actionable turns, widen external-contact redirect sanitization (`telefon numaramız`, `iletişim bilgilerinizi paylaşın`, etc.), and drop stale scenario issues when consistency summaries explicitly state the claim was cleared
- [x] Tighten Judge pricing false-positive cleanup and responder unknown-fallback grounding: clear scenario-level/conversation-level pricing-detail penalties when KB has no numeric price and assistant gives pricing-basis guidance, and replace generic unknown replies with best available grounded KB detail before follow-up prompting
- [x] Extend Judge finding consistency cleanup for follow-up-style false positives: treat `insufficient follow-up / inquiry` phrasing as did-not-ask category, and drop top-level findings when cited scenario summary explicitly states that the corresponding claim was cleared by consistency checks
- [x] Strengthen generator + judge realism gates: enforce minimum actionable lead-intent scenario ratio, add semantic-duplication checks for scenario openings/goals, soften missing-field penalties when remaining field was asked on the final turn, and normalize QA assistant numeric/punctuation surface artifacts (`12. 000` -> `12.000`)
- [x] Add generator-side scenario auto-stabilization for actionable-coverage failures: when generated scenario packs miss required lead-intent ratio, rewrite a minimal subset to diverse sector-agnostic actionable openings/goals before final quality validation so retries do not fail on repeated low-actionable output
- [x] Calibrate judge for cold-resistant informational cases: clear generic `lack of proactive questioning` warnings/findings when request mode is `general_information`, coverage is already sufficient, and assistant behavior stays grounded/non-pushy
- [x] Harden QA response language lock by improving Turkish ASCII detection (`Sadece iptal edin yeter`) and normalizing mixed-language fallback snippets so assistant replies stay in the user’s turn language
- [x] Tighten QA assistant closure quality: keep one-turn deferred retry tolerance (without refusal pressure), enforce explicit follow-up missing-field closure questions, guarantee question-first answer chunks for direct asks, and replace filler-style low-info enrichments with grounded concise detail + mini-summary next-step phrasing
- [x] Refine resistant-flow trustworthiness: closure summaries now require explicit customer evidence, snake_case intake fields are humanized in user-facing questions, and resistant pricing turns use a single soft critical-field ask with no-pressure fallback wording
- [x] Unit tests for core logic
- [x] Integration tests for WhatsApp flow
- [x] E2E tests for admin panel
- [x] Load testing for message handling

---

## Phase 10: Pilot Launch
- [ ] Onboard 5 pilot customers
- [ ] Monitor success metrics
- [ ] Collect feedback
- [ ] Iterate based on learnings

---

## Post-MVP (Future)
- [ ] Calendar / booking integration
- [ ] Flow builder
- [ ] Auto follow-up sequences
- [ ] Vertical preset marketplace
